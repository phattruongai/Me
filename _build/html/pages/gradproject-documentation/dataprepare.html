
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Chuẩn bị dữ liệu &#8212; Phat Truong</title>
    
  <link rel="stylesheet" href="../../_static/css/index.f658d18f9b420779cfdf24aa0a7e2d77.css">

    
  <link rel="stylesheet"
    href="../../_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../../_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../../_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    
      
  <link rel="stylesheet"
    href="../../_static/vendor/open-sans_all/1.44.1/index.css">
  <link rel="stylesheet"
    href="../../_static/vendor/lato_latin-ext/1.44.1/index.css">

    
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/sphinx-book-theme.37f24b989f4638ff9c27c22dc7559d4f.css" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../../_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/mystnb.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/panels-main.c949a650a448cc0ae9fd3441c0e17fb0.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/panels-variables.06eb56fa6e07937060861dad626602ad.css" />
    
  <link rel="preload" as="script" href="../../_static/js/index.d3f166471bb80abb5163.js">

    <script id="documentation_options" data-url_root="../../" src="../../_static/documentation_options.js"></script>
    <script src="../../_static/jquery.js"></script>
    <script src="../../_static/underscore.js"></script>
    <script src="../../_static/doctools.js"></script>
    <script src="../../_static/togglebutton.js"></script>
    <script src="../../_static/clipboard.min.js"></script>
    <script src="../../_static/copybutton.js"></script>
    <script >var togglebuttonSelector = '.toggle, .admonition.dropdown, .tag_hide_input div.cell_input, .tag_hide-input div.cell_input, .tag_hide_output div.cell_output, .tag_hide-output div.cell_output, .tag_hide_cell.cell, .tag_hide-cell.cell';</script>
    <script src="../../_static/sphinx-book-theme.7d483ff0a819d6edff12ce0b1ead3928.js"></script>
    <script async="async" src="https://unpkg.com/thebelab@latest/lib/index.js"></script>
    <script >
        const thebe_selector = ".thebe"
        const thebe_selector_input = "pre"
        const thebe_selector_output = ".output"
    </script>
    <script async="async" src="../../_static/sphinx-thebe.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="Huấn luyện" href="training.html" />
    <link rel="prev" title="Overview" href="overview.html" />

    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="docsearch:language" content="en" />



  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="80">
    

    <div class="container-xl">
      <div class="row">
          
<div class="col-12 col-md-3 bd-sidebar site-navigation show" id="site-navigation">
    
        <div class="navbar-brand-box">
<a class="navbar-brand text-wrap" href="../../index.html">
  
  <img src="../../_static/logo.jpg" class="logo" alt="logo">
  
  
  <h1 class="site-logo" id="site-title">Phat Truong</h1>
  
</a>
</div><form class="bd-search d-flex align-items-center" action="../../search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search this book..." aria-label="Search this book..." autocomplete="off" >
</form>
<nav class="bd-links" id="bd-docs-nav" aria-label="Main navigation">
    <p class="caption collapsible-parent">
 <span class="caption-text">
  GRADUATION PROJECT DOCUMENTATION
 </span>
</p>
<ul class="current nav sidenav_l1">
 <li class="toctree-l1">
  <a class="reference internal" href="overview.html">
   Overview
  </a>
 </li>
 <li class="toctree-l1 current active">
  <a class="current reference internal" href="#">
   Chuẩn bị dữ liệu
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="training.html">
   Huấn luyện
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="deploy.html">
   Triển khai
  </a>
 </li>
</ul>

</nav> <!-- To handle the deprecated key -->

</div>


          


          
<main class="col py-md-3 pl-md-4 bd-content overflow-auto" role="main">
    
    <div class="topbar container-xl fixed-top">
    <div class="topbar-contents row">
        <div class="col-12 col-md-3 bd-topbar-whitespace site-navigation show"></div>
        <div class="col pl-md-4 topbar-main">
            
            <button id="navbar-toggler" class="navbar-toggler ml-0" type="button" data-toggle="collapse"
                data-toggle="tooltip" data-placement="bottom" data-target=".site-navigation" aria-controls="navbar-menu"
                aria-expanded="true" aria-label="Toggle navigation" aria-controls="site-navigation"
                title="Toggle navigation" data-toggle="tooltip" data-placement="left">
                <i class="fas fa-bars"></i>
                <i class="fas fa-arrow-left"></i>
                <i class="fas fa-arrow-up"></i>
            </button>
            
            
<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn" aria-label="Download this page"><i
            class="fas fa-download"></i></button>

    <div class="dropdown-buttons">
        <!-- ipynb file if we had a myst markdown file -->
        
        <!-- Download raw file -->
        <a class="dropdown-buttons" href="../../_sources/pages/gradproject-documentation/dataprepare.md"><button type="button"
                class="btn btn-secondary topbarbtn" title="Download source file" data-toggle="tooltip"
                data-placement="left">.md</button></a>
        <!-- Download PDF via print -->
        <button type="button" id="download-print" class="btn btn-secondary topbarbtn" title="Print to PDF"
            onClick="window.print()" data-toggle="tooltip" data-placement="left">.pdf</button>
    </div>
</div>

            <!-- Source interaction buttons -->


            <!-- Full screen (wrap in <a> to have style consistency -->
            <a class="full-screen-button"><button type="button" class="btn btn-secondary topbarbtn" data-toggle="tooltip"
                    data-placement="bottom" onclick="toggleFullScreen()" aria-label="Fullscreen mode"
                    title="Fullscreen mode"><i
                        class="fas fa-expand"></i></button></a>

            <!-- Launch buttons -->

        </div>

        <!-- Table of contents -->
        <div class="d-none d-md-block col-md-2 bd-toc show">
            
        <div class="tocsection onthispage pt-5 pb-3">
            <i class="fas fa-list"></i> Contents
        </div>
        <nav id="bd-toc-nav">
            <ul class="nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#clone-github-ve-local-machine-cua-minh">
   1. Clone github về local machine của mình:
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#to-chuc-thu-muc">
   2. Tổ chức thư mục
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#tien-xu-li-va-dong-goi-du-lieu">
   3. Tiền xử lí và đóng gói dữ liệu:
  </a>
 </li>
</ul>

        </nav>
        
        </div>
    </div>
</div>
    <div id="main-content" class="row">
        <div class="col-12 col-md-9 pl-md-3 pr-md-0">
        
              <div>
                
  <div class="section" id="chuan-bi-du-lieu">
<h1>Chuẩn bị dữ liệu<a class="headerlink" href="#chuan-bi-du-lieu" title="Permalink to this headline">¶</a></h1>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Download dữ liệu tại <a class="reference external" href="https://phat-collection.s3-ap-southeast-1.amazonaws.com/cachua_resize2.rar">đây</a></p>
</div>
<div class="section" id="clone-github-ve-local-machine-cua-minh">
<h2>1. Clone github về local machine của mình:<a class="headerlink" href="#clone-github-ve-local-machine-cua-minh" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li><p>Chạy:</p></li>
</ul>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">git</span> <span class="n">clone</span> <span class="n">https</span><span class="p">:</span><span class="o">//</span><span class="n">github</span><span class="o">.</span><span class="n">com</span><span class="o">/</span><span class="n">phattruongai</span><span class="o">/</span><span class="n">Tomato</span><span class="o">-</span><span class="n">classification</span><span class="o">-</span><span class="n">system</span><span class="o">.</span><span class="n">git</span>
<span class="n">cd</span> <span class="n">Tomato</span><span class="o">-</span><span class="n">classification</span><span class="o">-</span><span class="n">system</span><span class="o">/</span><span class="n">Classification</span>
</pre></div>
</div>
</div>
<div class="section" id="to-chuc-thu-muc">
<h2>2. Tổ chức thư mục<a class="headerlink" href="#to-chuc-thu-muc" title="Permalink to this headline">¶</a></h2>
<p>Sau khi download dữ liệu về và giải nén thì ta sẽ có 1 thư mục tên <code class="docutils literal notranslate"><span class="pre">cachua_resize2</span></code>, đặt thư mục này như đường dẫn sau <code class="docutils literal notranslate"><span class="pre">Tomato-classification-system/Classification/cachua_resize2</span></code></p>
<ul class="simple">
<li><p>Cây thư mục:</p></li>
</ul>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>Classification
    |---cachua_resize2
        |---train
        |   |---loai1
        |   |---loai2
        |   |---loai3
        |   |---loai4
        |   |---loai5
        |   `---loai6
        `---test
            |---loai1
            |---loai2
            |---loai3
            |---loai4
            |---loai5
            `---loai6
</pre></div>
</div>
</div>
<div class="section" id="tien-xu-li-va-dong-goi-du-lieu">
<h2>3. Tiền xử lí và đóng gói dữ liệu:<a class="headerlink" href="#tien-xu-li-va-dong-goi-du-lieu" title="Permalink to this headline">¶</a></h2>
<p>Mở file <code class="docutils literal notranslate"><span class="pre">Classification/make_data_and_preprocessing/make_data/make_data/make_data.py</span></code> để xem các đoạn code, mình sẽ giải thích một số đoạn, để đơn giản, các bạn chỉ cần chạy script như cuối phần này</p>
<ul class="simple">
<li><p>Resize và normalize:</p></li>
</ul>
<blockquote>
<div><p>Tất cả các ảnh được đưa về 100x100 và chia 255 để có giá trị nằm trong khoảng [0,1]</p>
</div></blockquote>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">train_classes</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="n">train_dir</span><span class="p">)</span>
<span class="n">x_train</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">y_train</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">i</span> <span class="o">=</span> <span class="mi">0</span>
<span class="k">for</span> <span class="n">t_class</span> <span class="ow">in</span> <span class="n">train_classes</span><span class="p">:</span>
    <span class="n">y_now</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="mi">6</span><span class="p">,))</span>
    <span class="n">t_list</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="n">train_dir</span><span class="o">+</span><span class="n">t_class</span><span class="p">)</span>
    <span class="n">y_now</span><span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">t_class</span><span class="p">[</span><span class="mi">4</span><span class="p">])</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="k">for</span> <span class="n">img_name</span> <span class="ow">in</span> <span class="n">t_list</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">t_class</span><span class="p">,</span><span class="n">img_name</span><span class="p">)</span>
        <span class="n">img</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">imread</span><span class="p">(</span><span class="n">train_dir</span><span class="o">+</span><span class="n">t_class</span><span class="o">+</span><span class="s2">&quot;/&quot;</span><span class="o">+</span><span class="n">img_name</span><span class="p">)</span>
        <span class="n">img</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">resize</span><span class="p">(</span><span class="n">img</span><span class="p">,(</span><span class="mi">100</span><span class="p">,</span><span class="mi">100</span><span class="p">))</span> <span class="c1">#resize</span>
        <span class="n">img</span> <span class="o">=</span> <span class="n">img</span><span class="o">/</span><span class="mi">255</span> <span class="c1">#normalization</span>
        <span class="n">x_train</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">img</span><span class="p">)</span>
        <span class="n">y_train</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">y_now</span><span class="p">)</span>
</pre></div>
</div>
<ul class="simple">
<li><p>Đóng gói bằng thư viện h5py:</p></li>
</ul>
<p>Sau khi tạo ra được mảng x_train và y_train dưới dạng numpy.array, ta lưu vào file h5py để tiện việc sử dụng nhiều lần trong lúc huấn luyện</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">x_train</span><span class="p">)</span> <span class="c1">#data, shape (num_image,100,100,3)</span>
<span class="n">y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">y_train</span><span class="p">)</span> <span class="c1">#label,shape (num_image,6)</span>
<span class="nb">print</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="p">))</span>
<span class="n">x_train</span><span class="p">,</span><span class="n">y_train</span> <span class="o">=</span> <span class="n">shuffle_data</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">)</span>
<span class="k">with</span> <span class="n">h5py</span><span class="o">.</span><span class="n">File</span><span class="p">(</span><span class="n">args</span><span class="o">.</span><span class="n">output</span><span class="p">,</span><span class="s1">&#39;w&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">F</span><span class="p">:</span>
    <span class="n">F</span><span class="o">.</span><span class="n">create_dataset</span><span class="p">(</span><span class="s1">&#39;x_train&#39;</span><span class="p">,</span><span class="n">data</span> <span class="o">=</span> <span class="n">x_train</span><span class="p">)</span>
    <span class="n">F</span><span class="o">.</span><span class="n">create_dataset</span><span class="p">(</span><span class="s1">&#39;y_train&#39;</span><span class="p">,</span><span class="n">data</span> <span class="o">=</span> <span class="n">y_train</span><span class="p">)</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Để đơn giản, chỉ cần chạy script dưới đây</p>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">python3</span> <span class="n">make_data_and_preprocessing</span><span class="o">/</span><span class="n">make_data</span><span class="o">/</span><span class="n">make_data</span><span class="o">/</span><span class="n">make_data</span><span class="o">.</span><span class="n">py</span> <span class="o">--</span><span class="n">working</span> <span class="o">.</span> <span class="o">--</span><span class="n">output</span> <span class="n">train_data_100</span><span class="o">.</span><span class="n">h5</span>
</pre></div>
</div>
<p>Sau khi chạy xong, ta có file <code class="docutils literal notranslate"><span class="pre">train_data_100.h5</span></code> là file lưu dataset trực tiếp dưới dạng numpy array, tiện để load lên dùng lại nhiều lần trong lúc train. <strong>Lưu ý, với các dataset cực lớn thì lưu trực tiếp vào h5py sẽ không có lợi, thậm chí không chạy được vì không đủ RAM, khi đó ta sẽ dùng các cách khác để load dataset theo từng phần nhỏ trong lúc huấn luyện</strong></p>
</div>
</div>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            kernelName: "python3",
            path: "./pages/gradproject-documentation"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

              </div>
              
        
        <div class='prev-next-bottom'>
            
    <a class='left-prev' id="prev-link" href="overview.html" title="previous page">Overview</a>
    <a class='right-next' id="next-link" href="training.html" title="next page">Huấn luyện</a>

        </div>
        
        </div>
    </div>
    <footer class="footer mt-5 mt-md-0">
    <div class="container">
      <p>
        
          By Phat Truong<br/>
        
            &copy; Copyright 2021.<br/>
      </p>
    </div>
  </footer>
</main>


      </div>
    </div>

    
  <script src="../../_static/js/index.d3f166471bb80abb5163.js"></script>


    
  </body>
</html>